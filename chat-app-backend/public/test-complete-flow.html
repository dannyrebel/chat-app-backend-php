<!doctype html>
<html>
  <body>
    <h2>Test Complete Doctrine Flow</h2>

    <button onclick="step1()">1. Create User</button>
    <button onclick="step2()">2. Create Group</button>
    <button onclick="step3()">3. Join Group</button>
    <button onclick="step4()">4. Send Message</button>
    <button onclick="step5()">5. Get Messages</button>

    <pre id="result"></pre>

    <script>
      async function step1() {
        const response = await fetch("http://localhost:8000/users", {
          method: "POST",
        });
        const data = await response.json();
        document.getElementById("result").textContent =
          "Step 1 - User created:\n" + JSON.stringify(data, null, 2);
      }

      async function step2() {
        const response = await fetch("http://localhost:8000/groups", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: "Test Group" }),
        });
        const data = await response.json();
        document.getElementById("result").textContent =
          "Step 2 - Group created:\n" + JSON.stringify(data, null, 2);
      }

      async function step3() {
        const response = await fetch("http://localhost:8000/groups/1/join", {
          method: "POST",
        });
        const data = await response.json();
        document.getElementById("result").textContent =
          "Step 3 - Joined group:\n" + JSON.stringify(data, null, 2);
      }

      async function step4() {
        const response = await fetch(
          "http://localhost:8000/groups/1/messages",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: "Hello from Doctrine!" }),
          },
        );
        const data = await response.json();
        document.getElementById("result").textContent =
          "Step 4 - Message sent:\n" + JSON.stringify(data, null, 2);
      }

      async function step5() {
        const response = await fetch("http://localhost:8000/groups/1/messages");
        const data = await response.json();
        document.getElementById("result").textContent =
          "Step 5 - Messages retrieved:\n" + JSON.stringify(data, null, 2);
      }
    </script>
  </body>
</html>
